{% extends 'horizontal/home_app.html' %}
{% load filter_tags %}
{% load static %}

{% block css-extender %}

<link href="{% static 'app-design/assets/css/vendor/jstree.min.css' %}" rel="stylesheet" type="text/css">

<style>
      .wrapper {
        position: relative;
        overflow: auto;
        white-space: nowrap;
      }

      .sticky-col {
        position: -webkit-sticky;
        position: sticky;
        z-index:2
      }
      
      .first-col {
        width: 50px;
        min-width: 50px;
        max-width: 50px;
        left: 0px;
        background-color: white!important;
      }
      
      .second-col {
        width: 200px;
        min-width: 200px;
        max-width: 400px;
        left: 50px; /* you have to count the first-col width => your border width */
        background-color: white!important
      }

      .header-col {
        background-color:#2262AB!important;
        z-index:4
      }
    /* separate table part and td, th part */

    table {
         border-collapse: separate;
         border-spacing: 0;
    }

    thead, tr>th {
        position: sticky;
    }   

    thead {
        top: 0;
        z-index: 3;
    }
   
</style>

<style>
    #expandButton:focus {     
        box-shadow:none;    
    }
</style>
{% endblock css-extender %}

{% block main-content %}
<!-- START HERO -->

<section class="hero-section" >
    <div class="container">
        <div class="row align-items-center" id="search-content">
            <div class="col-md-6 mt-4">
                <div class="">
                    <div>
                        <span class="badge bg-danger rounded-pill">Baru</span> 
                        <span class="text-white-50 ms-1">Selamat datang di portal Satu Data Muna</span>
                    </div>
                    <h3 class="text-white fw-normal my-3 hero-title">
                        Telusuri Data Statistik Kabupaten Muna
                    </h3>
                    <p class="pr-2 mb-3 font-15 text-white-50"><span class="text-white fw-normal">SDM</span> merupakan wujud sinergi dan kolaborasi bersama antara BPS Kab. Muna selaku penyedia layanan data.</p>

                    <div class="row align-items-start">
                        <div class="col-lg-12 d-flex justify-content-start">
                            <div class="app-search dropdown">
                                <form>
                                    <div class="row gy-2 gx-2">
                                        <div class="col-12">
                                            <div class="input-group">
                                                <input type="text" class="form-control" placeholder="Telusuri data statistik ..." id="top-search-mitra" autocomplete="off" style="width:400px;height:50px;background-color:#ffffff;border-radius:5px">
                                                <span class="mdi mdi-magnify search-icon" style="margin-top:5px"></span>
                                                <button class="btn btn-danger rounded" style="height:48px;margin-left:8px" id="button-top-search">Telusuri Data</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 offset-md-2">
                <div class="text-md-end mt-1">
                    <img src="{% static 'app-design/assets/images/startup.svg' %}" alt="" class="img-fluid">
                </div>
            </div>
        </div>
    </div>
</section>

<!-- END HERO -->
<section class="pt-5 pb-3 bg-white" id="main-content" style="margin-top:-50px;"> 
    <div class="container">
        <div class="row px-4">
            <div class="row justify-content-end">
                <button class="btn bg-white"  style="width:100px; height:40px; font-size:12px; border-radius:20px; margin-top:-90px; padding: 8px 0px 8px 5px; z-index:10; margin-right:10px!important;" id="expandButton">Expand <i class="mdi mdi-arrow-up-down"></i></button>
            </div>
         
            <div class="row">
                <div class="mb-3">
                    <a class="btn btn-primary btn-primary px-2" href="{% url 'app:statistics-app' %}"><i class="mdi mdi-chevron-left"></i> Kembali</a>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box">
                        <div class="page-title-left">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="javascript: void(0);" style="color:#003C80">Beranda</a></li>
                                <li class="breadcrumb-item active text-truncate"><a href="javascript: void(0);" style="color:#003C80">Data Strategis</a></li>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="row pt-2">
    
                <div class="col-lg-9">
    
                    <div class="mb-2">
                        <h3 class="font-weight-bold" style="color:#003C80"><strong>Data Strategis Kab. Muna</strong></h3>
                    </div>
    
                    <div class="mb-3 mt-4">
                        <h5>Konsep Data: </h5>
                        <div class="mt-1">
                            <p>Revolusi Mental merupakan Gerakan untuk mengubah cara pandang, cara piker, sikap, perilaku, dan cara kerja bangsa Indonesia, yang mengacu pada nilai-nilai integritas, etos kerja, gotong royong, berlandaskan Pancasila sehingga bangsa Indonesia menjadi negara yang maju, modern, makmur, sejahtera, dan bermartabat.
                            </p>
                        </div>
                    </div>
                </div>
       
                <div class="col-lg-3">
                    <div class="card" id="datasetCard" style="background-color:#fff; box-shadow:none">
                        <div class="card-body" >
                            <div>
                                <h5>Data Menurut Periode: </h5>
                                <div class="mt-1">
                                    <div id="jstree-1">
                                        <ul>
                                            {% for dt in datasets  %}
                                                <li {% if forloop.first %}data-jstree='{"opened" : true }'{% endif %}>
                                                    <a href="#">{{dt.group}}</a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                           
                        </div> <!-- end card-body-->
                    </div> <!-- end card-->
                </div>
    
            </div>
            
        </div>
    </div>
</section>

<section class="pt-2 pb-5">

    <div class="container">
        <div class="row py-3 px-4">
            <div class="col-12">
                <ul class="nav nav-pills bg-nav-pills nav-justified mt-3" style="border-radius:20px; font-size:13px">
                    {% for dt in datasets  %}
                        <li class="nav-item">
                            <a href="#tab_{{dt.group}}" data-bs-toggle="tab" class="nav-link py-2 {% if forloop.first %}active{% endif %}" style="border-radius:20px;">
                                <i class="mdi mdi-home-variant d-md-none d-block"></i>
                                <span class="d-none d-md-block">{{dt.group}}</span>
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="row py-2">
            <div class="col-12">
                <div class="tab-content">
                    {% for dt in datasets %}
                        <div class="tab-pane {% if forloop.first %}show active{% endif %}" id="tab_{{dt.group}}">
                            <div class="row py-4">
                                <div class="col-lg-12 px-4" id="data-pane">
                                    <div class="card" >
                                        <div class="card-body px-3">
                                            <div class="mb-3">
                                                <h4 class="font-weight-bold"><strong>[Data Strategis] Menurut Periode {{dt.group}}</strong></h4>
                                            </div>
                                            <div class="row my-1">
                                                <div class="col-sm-4 d-flex align-items-end">
                                                    <p class="font-weight-light font-13">Terakhir diperbarui: {{dt.items_group.0.last_updated}}</p>
                                                </div>
                                                <div class="col-sm-8 d-flex justify-content-end" style="padding-right:18px!important">
                                                    <input type="text" id="searchBar" class="form-control mx-2" placeholder="Cari Data ..." style="width:250px">
                                                    <button type="button" class="btn btn-primary" style="margin-right:3px!important"   id="clipboard-btn" onclick="showFilter()"><i class="mdi mdi-filter"></i> </button>
                                                    <button type="button" class="btn btn-success" style="margin-right:3px!important" data-bs-toggle="popover" title="Berhasil !" data-bs-content="Tautan berhasil disalin."><i class="mdi mdi-clipboard-file"></i> </button>
                                                    <button type="button" class="btn btn-info" style="margin-right:3px!important"><i class="mdi mdi-file-excel"></i> </button>
                                                </div>
                                            </div>
                        
                                            <input type="hidden" name="indicator_id" id="indicator_id" value="{{data_indicator.id}}">
                                            <input type="hidden" name="year" id="year" value="{{current_year}}">
                                            <input type="hidden" name="item_period" id="item_period" value="{{period.id}}">
                        
                                            <div class="wrapper">
                                                <table class="table table-sm table-striped table-centered nowrap w-100 mb-1 font-14" id="content-table">
                                                    <thead style="background-color:#2262AB;color:white">
                                                        <tr>
                                                            <th rowspan="2" class="text-center sticky-col header-col first-col">No</th>
                                                            <th rowspan="2" class="text-center sticky-col header-col second-col">Indikator Strategis</th>
                                                            <th class="text-center" colspan="{{dt.period_basic|length}}">{{dt.group}}</th>
                                                            <th rowspan="2" class="text-center"></th>
                                                        </tr>
                                                        <tr>
                                                            {% for dt_period in dt.period_basic %}
                                                                <th class="text-center">{{dt_period}}</th>
                                                            {% endfor %}
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for dt_ in dt.items_group  %}
                                                        <tr >
                                                            <td class="text-center sticky-col first-col">{{forloop.counter}}</td>
                                                            <td class="sticky-col second-col text-truncate" title="{{dt_.data}}">
                                                                {{dt_.data}}
                                                            </td>
                                                            {% for period_basic in dt.period_basic %}
                                                                {% with check=dt_.data_items|get_item_by_period:period_basic %}
                                                                    <td class="text-center">{{check}}</td>
                                                                {% endwith %}
                                                            {% endfor %}
                                                            <td class="text-center">
                                                                <button class="btn btn-sm btn-primary" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                    <i class="mdi mdi-chevron-right"></i>
                                                                </button>
                                                                <div class="dropdown-menu" style="font-size:14px;">
                                                                    <a class="dropdown-item pb-0" href="{{dt_.href}}" target="_blank"><i class="mdi mdi-magnify-scan"></i> Lihat Data</a>
                                                                    <a class="dropdown-item" href="#"><i class="mdi mdi-download"></i> Unduh Data</a> 
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            <h5 class="font-weight-light font-13 mt-3">Keterangan:</h5>
                                            <ul><li class="font-13">None : Data belum tersedia</li></ul>
                                            <h5 class="font-weight-light font-13 mt-2">Sumber:</h5>
                                            <ul>{% for src in sources  %}<li class="font-13">{{src}}</li>{% endfor %}</ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock main-content %}


{% block js-extender %}

<script src="{% static 'app-design/assets/js/vendor/jstree.min.js' %}"></script>
<script src="{% static 'app-design/assets/js/pages/demo.jstree.js' %}"></script>

<script src="{% static 'app-design/assets/js/vendor/Chart.bundle.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script src="{% static 'app-design/assets/js/pages/demo.dashboard-projects.js' %}"></script>

<script>

    $( window).resize(function(){
        if($(this).width() <= 768){
            $("#search-content").addClass('d-none')
            $(".hero-section").removeAttr('style')
            $("#main-content").css('margin-top', '-200px')
            $("#expandButton").addClass('d-none')
            $("#top-search-mitra").css('width', '200px')
        }else{
            $("#search-content").removeClass('d-none')
            $(".hero-section").css('height', '630px')    
            $("#main-content").css('margin-top', '-50px')
            $("#expandButton").removeClass('d-none')
            $("#top-search-mitra").css('width', '400px')
        }
    });


    $("#expandButton").on('click', function (event){
        if ($('#main-content').css('margin-top') == '-50px'){
            $("#search-content").addClass('d-none')
            $(".hero-section").removeAttr('style')
            $("#main-content").css('margin-top', '-200px')
            $(this).parent().css({'bottom': '-98px'})
        }else{
            $(this).parent().css('bottom', '-253px')
            $(".hero-section").css('height', '630px')    
            $("#search-content").removeClass('d-none')
            $("#main-content").css('margin-top', '-50px')
        }
    })

</script>

<script>

    function showFilter(){
        if ($('#filter-pane').hasClass('d-none')){
            $('#filter-pane').removeClass('d-none')
            $('#data-pane').attr('class', 'col-lg-9 px-3')
        }else{
            $('#data-pane').attr('class', 'col-lg-12 px-4')
            $('#filter-pane').addClass('d-none')
        }
    }

    function showData(){
        if ($('.compare-item').hasClass('d-none')){
            $('.compare-item').removeClass('d-none')
        }else{
            $('.compare-item').addClass('d-none')
        }
    }

    function show_comparison_panel(state){

        if (state == 'comp'){
            $("#comparison-card").removeClass('d-none')
            $("#dataset-card").addClass('d-none')
        }else{
            $("#dataset-card").removeClass('d-none')
            $("#comparison-card").addClass('d-none')
        }
    }

    new Chart('pie-chart', {
        type: 'doughnut',
        data: {
        datasets: [
        /* Outer doughnut data starts*/
        {
            data: [
            10,
            20,
            30
            ],
            backgroundColor: ['#17A589'],
            label: 'Tahun 2024',
        },
        /* Outer doughnut data ends*/
        /* Inner doughnut data starts*/
        {
            data: [
            45,
            25,
            11
            ],
            backgroundColor:['#17A589'],
            label: 'Tahun 2023',
            
        }
        /* Inner doughnut data ends*/
        ],
        labels: [
            "Kab. Muna Barat",
            "Kab. Muna",
            "Kota Kendari"
        ]
        },
        options: {
            plugins: {
                datalabels: {
                formatter: (value) => {
                    return value + '%';
                },
                },
            },
            title: {
                position: 'right',
                display: true,
                text: ['Layer 1: Tahun 2023','Layer 2: Tahun 2024'],
                fontSize:11,
                fontStyle:'normal',
                fontFamily: ['Nunito', 'sans-serif']
            },
            legend: {
            position: 'right',
            labels: {
                usePointStyle: true
            },
            },
        }
    })


    let draw = Chart.controllers.line.prototype.draw;
    Chart.controllers.line = Chart.controllers.line.extend({
        draw: function() {
            let ctx = this.chart.chart.ctx;
            ctx.save();
            ctx.shadowColor = '#1CB395';
            ctx.shadowBlur = 12;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 5;
            ctx.stroke();
            draw.apply(this, arguments);
            ctx.restore();
        }
    });

    new Chart('task-line-chart', {
        type: 'line',
        
        data: {
            labels: ['2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023'],    
            datasets: [
            {
                label: 'Male',
                data: [56.4, 47.0, 42.0, 54.3, 39.4, 27.4, 61, 51, 51.2],
                fill: false,
                borderColor: '#17A589',
                backgroundColor:'#17A589',
                borderWidth: 1.2,
                },
                {
                label: 'Female',
                data: [49.4, 44.0, 41.0, 42.3, 46.4, 45.4, 47, 48, 76.2],
                fill: false,
                borderColor: '#2E86C1',
                backgroundColor:'#2E86C1',
                borderWidth: 1.2,
                },
                {
                label: 'Male + Female',
                data: [51.4, 52.0, 52.0, 50.3, 51.4, 51.4, 62, 64, 60.2],
                fill: false,
                borderColor: '#B479FF',
                backgroundColor:'#B479FF',
                borderWidth: 1.2,
                },
            ]
        },
        options: {
            legend: {
            position: 'bottom',
            labels: {
                usePointStyle: true
            }
            },
            scales: {
            yAxes: [{
                ticks: {
                min: 0,
                max: 80,
                stepSize: 20
                },
                scaleLabel: {
                display: true,
                labelString: 'Percent (%)'
                }
            }],
            xAxes: [{
                gridLines: {
                    drawOnChartArea: false
                }
                },
            ]
            }
        },
        showDatapoints: true,

    })

    new Chart('task-bart-chart', {
        type: 'bar',
        data: {
            labels: ['2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023'],    
            datasets: [{
                label: 'Male',
                data: [42.4, 43.0, 43.0, 50.3, 49.4, 48.4, 50, 51, 60],
                backgroundColor: 'rgba(124, 181, 236, 0.9)',
                borderColor: 'rgb(124, 181, 236)',
                borderWidth: 1
            },
            {
                label: 'Female',
                data: [57.6, 57.0, 57.0, 49.7, 50.6, 51.6, 50, 51, 60],
                backgroundColor: 'rgba(67, 67, 72, 0.9)',
                borderColor: 'rgb(67, 67, 72)',
                borderWidth: 1
            },
            {
                label: 'Male + Female',
                data: [47.6, 47.0, 37.0, 49.7, 51.6, 53.6, 55, 50, 61],
                backgroundColor: 'rgba(67, 67, 72, 0.9)',
                borderColor: 'rgb(67, 67, 72)',
                borderWidth: 1
                }
            ]
        },
        options: {
            legend: {
            position: 'bottom',
            labels: {
                usePointStyle: true
            }
            },
            scales: {
            yAxes: [{
                ticks: {
                min: 0,
                max: 80,
                stepSize: 20
                },
                scaleLabel: {
                display: true,
                labelString: 'Percent (%)'
                }
            }],
            xAxes: [{
                gridLines: {
                    drawOnChartArea: false
                }
                },
                {
                offset: true,
                ticks: {
                    autoSkip: false,
                    maxRotation: 0,
                    padding: -15,
                    callback: (v, i) => {
                    if (i == 1) {
                        return 'Total';
                    } else if (i == 4) {
                        return 'Lower than 2.50';
                    } else {
                        return '';
                    }
                    }
                },
                gridLines: {
                    drawOnChartArea: false,
                    offsetGridLines: true,
                    tickMarkLength: 20,
                    color: ['white', 'white', 'white', 'lightgray', 'white', 'white', 'lightgray']
                }
                }
            ]
            }
        }
    });

    new Chart('task-bart-chart-2', {
        type: 'bar',
        data: {
            labels: ['2015', '2016'],    
            datasets: [{
                label: 'Male',
                data: [42.4, 43.0],
                backgroundColor: 'rgba(124, 181, 236, 0.9)',
                borderColor: 'rgb(124, 181, 236)',
                borderWidth: 1
            },
            {
                label: 'Female',
                data: [57.6, 57.0],
                backgroundColor: 'rgba(67, 67, 72, 0.9)',
                borderColor: 'rgb(67, 67, 72)',
                borderWidth: 1
            },
            {
                label: 'Male + Female',
                data: [47.6, 47.0],
                backgroundColor: 'rgba(67, 67, 72, 0.9)',
                borderColor: 'rgb(67, 67, 72)',
                borderWidth: 1
                }
            ]
        },
        options: {
            legend: {
            position: 'bottom',
            labels: {
                usePointStyle: true
            }
            },
            scales: {
            yAxes: [{
                ticks: {
                min: 0,
                max: 80,
                stepSize: 20
                },
                scaleLabel: {
                display: true,
                labelString: 'Percent (%)'
                }
            }],
            xAxes: [{
                gridLines: {
                    drawOnChartArea: false
                }
                },
                {
                offset: true,
                ticks: {
                    autoSkip: false,
                    maxRotation: 0,
                    padding: -15,
                    callback: (v, i) => {
                    if (i == 1) {
                        return 'Total';
                    } else if (i == 4) {
                        return 'Lower than 2.50';
                    } else {
                        return '';
                    }
                    }
                },
                gridLines: {
                    drawOnChartArea: false,
                    offsetGridLines: true,
                    tickMarkLength: 20,
                    color: ['white', 'white', 'white', 'lightgray', 'white', 'white', 'lightgray']
                }
                }
            ]
            }
        }
    });

    $(".yearPeriod").on("click", function (e) {
        var list_item = $(this).find('ul')
        if (!list_item.hasClass("show")){
            $('.yearPeriod').find('ul').not(list_item).removeClass('show').addClass('d-none');
            list_item.removeClass("d-none")
            list_item.addClass("show")
        } else{
            list_item.removeClass("show")
            list_item.addClass("d-none")
        }
        
    })

</script>

<script>
    $('#clipboard-btn').on('click', function(e){
        e.preventDefault()
        setTimeout(function () {
            $('#clipboard-btn').popover('hide');
        }, 1500);
    })

</script>
{% endblock js-extender %}
