{% extends 'horizontal/home_app.html' %}
{% load filter_tags %}

{% load static %}

{% block css-extender %}

<link href="{% static 'app-design/assets/css/vendor/jstree.min.css' %}" rel="stylesheet" type="text/css">

<style>
    .view {
        margin: auto;
        height:550px;
    }
      .wrapper {
        position: relative;
        overflow: auto;
        white-space: nowrap;
      }
      
      .sticky-col {
        position: -webkit-sticky;
        position: sticky;
        z-index:2
      }
      
      .first-col {
        width: 100px;
        min-width: 100px;
        max-width: 100px;
        left: 0px;
        background-color: white!important;
      }
      
      .second-col {
        width: 100px;
        min-width: 100px;
        max-width: 200px;
        left: 100px; /* you have to count the first-col width => your border width */
        background-color: white!important
      }
    
      .header-col {
        background-color:#2262AB!important;
        z-index:4
      }

      .first-row th {
        position: sticky;
        top: 0px;
      }
      
      .second-row th {
        position: sticky;
        top: 45px;
      }

      .border-between{
        border-right: 1px dashed #999
      }

    /* separate table part and td, th part */

    table {
         border-collapse: separate;
         border-spacing: 0;
    }

    thead, tr>th {
        position: sticky;
    }   

    thead {
        top: 0;
        z-index: 3;
    }
   
</style>

<style>
    #expandButton:focus {     
        box-shadow:none;    
    }
</style>
{% endblock css-extender %}

{% block main-content %}
<!-- START HERO -->
<section class="hero-section" >
    <div class="container">
        <div class="row align-items-center" id="search-content">
            <div class="col-md-6 mt-4">
                <div class="">
                    <div>
                        <span class="badge bg-danger rounded-pill">Baru</span> 
                        <span class="text-white-50 ms-1">Selamat datang di portal Satu Data Muna</span>
                    </div>
                    <h3 class="text-white fw-normal my-3 hero-title">
                        Telusuri Data Statistik Kabupaten Muna
                    </h3>
                    <p class="pr-2 mb-3 font-15 text-white-50"><span class="text-white fw-normal">SDM</span> merupakan wujud sinergi dan kolaborasi bersama antara BPS Kab. Muna selaku penyedia layanan data.</p>

                    <div class="row align-items-start">
                        <div class="col-lg-12 d-flex justify-content-start">
                            <div class="app-search dropdown">
                                <form>
                                    <div class="row gy-2 gx-2">
                                        <div class="col-12">
                                            <div class="input-group">
                                                <input type="text" class="form-control" placeholder="Telusuri data statistik ..." id="top-search-mitra" autocomplete="off" style="width:400px;height:50px;background-color:#ffffff;border-radius:5px">
                                                <span class="mdi mdi-magnify search-icon" style="margin-top:5px"></span>
                                                <button class="btn btn-danger rounded" style="height:48px;margin-left:8px" id="button-top-search">Telusuri Data</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 offset-md-2">
                <div class="text-md-end mt-1">
                    <img src="{% static 'app-design/assets/images/startup.svg' %}" alt="" class="img-fluid">
                </div>
            </div>
        </div>
    </div>
</section>

<!-- END HERO -->
<section class="py-4 bg-white" id="main-content" style="margin-top:-50px;"> 
    <div class="container " >
        <div class="row justify-content-end">
            <button class="btn bg-white"  style="width:100px; height:40px; font-size:12px; border-radius:20px; margin-top:-45px; padding: 8px 0px 8px 5px; z-index:10; margin-right:10px!important;" id="expandButton">Expand <i class="mdi mdi-arrow-up-down"></i></button>
        </div>
     
        <div class="row">
            <div class="mb-3">
                <a class="btn btn-primary btn-primary px-2" href="{% url 'app:statistics-app' %}"><i class="mdi mdi-chevron-left"></i> Kembali</a>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="page-title-box">
                    <div class="page-title-left">
                        <ol class="breadcrumb m-0">
                            <li class="breadcrumb-item"><a href="javascript: void(0);" style="color:#003C80">Beranda</a></li>
                            <li class="breadcrumb-item active text-truncate"><a href="javascript: void(0);" style="color:#003C80">Tabel Statistik</a></li>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <div class="row pt-2">

            <div class="col-lg-9">

                <div class="mb-2">
                    <h3 class="font-weight-bold" style="color:#003C80"><strong>{{table.name}}, ({{table.unit_id.name}})</strong></h3>
                </div>

                <div class="mb-3 mt-4">
                    <h5>Konsep dan Definisi: </h5>
                    <div class="mt-1">
                        <p>
                            {{table.desc}}
                        </p>
                    </div>
                </div>

                <div class="mb-3">
                    <h5>Satuan/Ukuran: </h5>
                    <div class="mt-1">
                        <p> {{table.unit_id.name}} </p>
                    </div>
                </div>

                <div class="mb-3">
                    <h5>Karakteristik Indikator: </h5>
                    <div class="mt-1">
                        <ul>
                            <li>Kelompok Baris: {{table.row_group_id.name}}</li>
                            <li>Kelompok Kolom: {% if table.col_group_id %} {{table.col_group_id.name}} {% else %} Series {{table.time_period_id.name}} {% endif %}</li>
                        </ul>
                    </div>
                </div>
    
                <div class="mb-3">
                    <h5>Sumber: </h5>
                    <div class="mt-1">
                        <p>{{table.footer_desc}}</p>
                    </div>
                </div>

            </div>
   
            <div class="col-lg-3">
                <div class="card" id="datasetCard" style="background-color:#fff; box-shadow:none">
                    <div class="card-body" style="padding:90px 25px 0px 35px">
                        <div class="mb-3">
                            <h5>Kategori Statistik: </h5>
                            <div class="mt-1">
                                <span class="badge bg-primary">{{table.get_stat_category_display}}</span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <h5>Periode Data: </h5>
                            <div class="mt-1">
                                <p>{{table.time_period_id.name}}</p>
                            </div>
                        </div>

                        <div>
                            <h5>Data Tersedia: </h5>
                            <div class="mt-1">
                                <div id="jstree-1">
                                    <ul>
                                        {% for period in periods %}
                                            {% if forloop.counter == 1 %}
                                            <li data-jstree='{"opened" : true }'>
                                            {% else %}
                                            <li>
                                            {% endif %}
                                                {{period.year}}
                                                <ul>
                                                    {% for item in period.periods %}
                                                    <li data-jstree='{ "icon" : "mdi mdi-file-chart-outline" }'>
                                                        <a href="#">{{item.name}}</a>
                                                    </li>
                                                    {% endfor %}
                                                </ul>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                       
                    </div> <!-- end card-body-->
                </div> <!-- end card-->
            </div>

        </div>
        
    </div>
</section>

<section class="pt-2 pb-5" id="section-table">
    <div class="container">
        <div class="row py-4">
            <div class="col-lg-3" id="sidebar-table-content" style="padding:20x 0px 20px 0px; ">
                <h4 class="p-2 mb-1" ><i class="mdi mdi-arch"></i> Pilih Dataset</h4>
                <div class="card mb-2 mt-3" id="dataset-card">
                    <div class="card-body">
                        <div class="d-flex align-items-center ">
                            <img class="me-2" src="{% static 'customs/images/conf-data.png' %}" width="30" alt="Generic placeholder image">
                            <h5 class="card-title mb-0" style="color:#003C80">Pengaturan Dataset</h5>
                        </div>

                        <div id="cardCollpase" class="collapse pt-3 show">
                            <div class="mb-3">
                                <h5>Periode: </h5>
                                <ul class="detailPeriod py-2" style="list-style:none;padding-left:5px;overflow-y: scroll;">

                                    {% for period in periods %}
                                    <li class="yearPeriod" style="cursor: pointer" >
                                        <i class="mdi mdi-chevron-right"></i>
                                        
                                        <span style="font-weight:bold">Tahun {{period.year}}</span>
                                        <ul class="py-2" style="list-style:none;padding-left:20px;">
                                            {% for item in period.periods %}
                                                <li style="padding-bottom:2px">
                                                    <div class="form-check">
                                                        <input type="checkbox" class="form-check-input border filterPeriod" id="check_{{period.year}}_{{item.id}}" value="{{period.year}}_{{item.id}}" {{item.checked}}>
                                                        <label class="filterPeriodLabel" for="check_{{period.year}}_{{item.id}}" style="font-weight:normal"><i class="mdi mdi-chart-box"></i> {{item.name}} </label>
                                                    </div>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                    {% endfor %}

                                </ul>
                                
                            </div>
            
                            <div class="mb-4">
                                <h5>Grafik: </h5>
                                <div class="mt-1">
                                    <ul style="list-style:none;padding-left:5px;">
                                        <li>
                                            <input type="checkbox" class="form-check-input" id="checkbox_bar" onchange="showChart('#graphBar')" checked>&ensp;
                                            <i class="mdi mdi-chart-bar"></i>
                                            <label for="checkbox_bar">Bar Chart</label>
                                        </li>
                                        <li>
                                            <input type="checkbox" class="form-check-input" id="checkbox_line" onchange="showChart('#graphLine')" checked>&ensp;
                                            <i class="mdi mdi-chart-line"></i>
                                            <label for="checkbox_line">Line Chart</label>
                                        </li>
                                        <li>
                                            <input type="checkbox" class="form-check-input" id="checkbox_pie" onchange="showChart('#graphPie')" checked>&ensp;
                                            <i class="mdi mdi-chart-pie"></i>
                                            <label for="checkbox_pie">Pie Chart</label>
                                        </li>
                                    </ul>
    
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary filterData"><i class="mdi mdi-filter me-1"></i> <span>Filter Data</span> </button>
                        </div>
                    </div>
                </div> <!-- end card-->

                <div class="card mb-2 mt-3 d-none" id="comparison-card">
                    <div class="card-body">
                        <div class="d-flex align-items-center ">
                            <img class="me-2" src="{% static 'customs/images/conf-data.png' %}" width="30" alt="Generic placeholder image">
                            <h5 class="card-title mb-0" style="color:#003C80">Bandingkan Dataset</h5>
                        </div>
                        <div id="cardCollpase" class="collapse pt-3 show">
                            <div class="mb-3">
                                <h5>Periode Pertama: </h5>
                                <ul class="detailPeriodStart py-2" style="list-style:none;padding-left:5px;overflow-y: scroll; height:100px">
                                    {% for period in periods %}
                                    <li class="yearPeriodStart" style="cursor: pointer" >
                                        <i class="mdi mdi-chevron-right"></i>
                                        <span style="font-weight:bold">Tahun {{period.year}}</span>
                                        <ul class="py-2" style="list-style:none;padding-left:20px;">
                                            {% for item in period.periods %}
                                                <li style="padding-bottom:2px">
                                                    <div class="form-check">
                                                        {% with check=period.year|add:'_'|add:item.id %}
                                                        <input type="checkbox" class="form-check-input border filterPeriodStart" id="check_start_{{period.year}}_{{item.id}}" value="{{period.year}}_{{item.id}}" {% if check == data_compare_req.0 %}checked{% endif %}>
                                                        <label class="filterPeriodLabelStart" for="check_start_{{period.year}}_{{item.id}}" style="font-weight:normal"><i class="mdi mdi-chart-box"></i> {{item.name}} </label>
                                                        {% endwith %}
                                                        
                                                    </div>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="mb-3">
                                <h5>Periode Kedua: </h5>
                                <ul class="detailPeriodAkhir py-2" style="list-style:none;padding-left:5px;overflow-y: scroll; height:100px">
                                    {% for period in periods %}
                                    <li class="yearPeriod" style="cursor: pointer" >
                                        <i class="mdi mdi-chevron-right"></i>
                                        <span style="font-weight:bold">Tahun {{period.year}}</span>
                                        <ul class="py-2" style="list-style:none;padding-left:20px;">
                                            {% for item in period.periods %}
                                                <li style="padding-bottom:2px">
                                                    <div class="form-check">
                                                        {% with check=period.year|add:'_'|add:item.id %}
                                                        <input type="checkbox" class="form-check-input border filterPeriodEnd" id="check_end_{{period.year}}_{{item.id}}" value="{{period.year}}_{{item.id}}" {% if check == data_compare_req.1 %}checked{% endif %}>
                                                        <label class="filterPeriodLabelEnd" for="check_end_{{period.year}}_{{item.id}}" style="font-weight:normal"><i class="mdi mdi-chart-box"></i> {{item.name}} </label>
                                                        {% endwith %}
                                                    </div>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>

                            <div class="mb-4">
                                <h5>Grafik: </h5>
                                <div class="mt-1">
                                    <ul style="list-style:none;padding-left:5px;">
                                        <li>
                                            <input type="checkbox" class="form-check-input" id="checkbox_compare" onchange="showChart('#chartComparison')" checked>&ensp;
                                            <i class="mdi mdi-chart-bar"></i>
                                            <label for="checkbox_compare">Bar Chart</label>
                                        </li>
                                    </ul>
                                </div>
                            </div>
    
                            <div class="mt-4 mb-3">
                              <button type="button" class="btn btn-primary compareData"><i class="mdi mdi-rocket me-1"></i> <span>Bandingkan Data</span> </button>
                            </div>
                        </div>
                    </div>
                </div> <!-- end card-->

            </div>
            <div class="col-lg-9 px-4" id="main-table-content">
                <ul class="nav nav-tabs nav-bordered mb-4" >
                    <li class="nav-item mx-1" onclick="show_comparison_panel('dataset')">
                        <a href="#dinamicTable" id="TableNav" data-bs-toggle="tab" aria-expanded="false" class="nav-link py-2 active">
                            <i class="mdi mdi-settings-outline d-md-none d-block"></i> 
                            <span class="d-none d-md-block" style="font-weight:300;">Tabel Statistik <i class="mdi mdi-file-table-box-multiple-outline"></i></span>
                        </a>
                    </li>
                    <li class="nav-item mx-1" onclick="show_comparison_panel('comp')">
                        <a href="#data_comparisons" id="TableNav" data-bs-toggle="tab" aria-expanded="false" class="nav-link py-2">
                            <i class="mdi mdi-account-circle d-md-none d-block"></i>
                            <span class="d-none d-md-block" style="font-weight:300;">Perbandingan Data <i class="mdi mdi-book-open-page-variant-outline"></i></span>
                        </a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane show active" id="dinamicTable">
                        <div class="card pb-3" >
                            <div class="card-body px-3 mt-4 mt-lg-0">
                                <div class="mb-3">
                                    <h4 class="font-weight-bold"><strong>{{table.name}}, ({{table.unit_id.name}})</strong></h4>
                                </div>
                                <div class="mt-1">
                                    <p class="font-weight-light font-13">Terakhir diperbarui: {{table_last_updated|date:"d F Y" }}</p>
                                </div>
                                <div class="row my-1">
                                    <div class="col-sm-6">
                                        <div class="form-check form-switch mb-2">
                                            <input type="checkbox" class="form-check-input" id="fullscreen_table">
                                            <label class="form-check-label font-14" for="fullscreen_table">Tampilan Penuh</label>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 d-flex justify-content-end" style="padding-right:18px!important">
                                        <button type="button" class="btn btn-primary" style="margin-right:3px!important" data-bs-toggle="popover" title="Berhasil !" data-bs-content="Tautan berhasil disalin."  id="clipboard-btn"><i class="mdi mdi-clipboard-file"></i> </button>
                                        <button type="button" class="btn btn-success" style="margin-right:3px!important"><i class="mdi mdi mdi-file-excel"></i> </button>
                                        <button type="button" class="btn btn-info" style="margin-right:3px!important"><i class="mdi mdi-file-pdf"></i> </button>
                                    </div>
                                </div>

                                <input type="hidden" name="indicator_id" id="indicator_id" value="{{data_indicator.id}}">
                                <input type="hidden" name="year" id="year" value="{{current_year}}">
                                <input type="hidden" name="item_period" id="item_period" value="{{period.id}}">

                                <div class="wrapper">
                                    <table class="table table-sm table-striped table-centered nowrap w-100 font-13" id="content-table">
                                        <thead style="background-color:#2262AB;color:white">
                                            <tr>
                                                <th rowspan="4" class="text-center sticky-col header-col first-col">No</th>
                                                <th rowspan="4" class="text-center sticky-col header-col second-col">{{table.row_group_id.name}}</th>
                                            </tr>
                                            
                                            {% for item_years in data_contents.0.items %}
                                                <tr>
                                                    <th colspan="{{ col_span }}" class="text-center">Tahun {{item_years.year}}</th>
                                                </tr>

                                                <tr>
                                                {% for item_periods in item_years.items %}
                                                    <th colspan="{{item_periods.items|length}}" class="text-center">{{ item_periods.item_period }}</th>
                                                {% endfor %}
                                                </tr>

                                                <tr>
                                                {% for item_periods in item_years.items %}
                                                    {% for item_cols in item_periods.items %}
                                                        <th class="text-center">{{ item_cols.item_char }}</th>
                                                    {% endfor %}
                                                {% endfor %}
                                                </tr>

                                            {% endfor %} 
                                            
                                        </thead>
                                        <tbody>
                                            
                                            {% for item_rows in data_contents %}
                                                <tr>
                                                    <td class="text-center sticky-col first-col">{{forloop.counter}}</td>
                                                    <td class="sticky-col second-col">{{item_rows.row_name}}</td>
                                                    {% for item_years in item_rows.items %}
                                                        {% for item_periods in item_years.items %}
                                                            {% for item_cols in item_periods.items %}
                                                                {% if forloop.last %}
                                                                    <td class="text-center border-between">{{ item_cols.value }}</td>
                                                                {% else %}
                                                                    <td class="text-center">{{ item_cols.value }}</td>
                                                                {% endif %}
                                                            {% endfor %}
                                                        {% endfor %}
                                                    {% endfor %}
                                                </tr>
                                            {% endfor %}

                                        </tbody>
                                    </table>
                                </div>

                                <h5 class="font-weight-light font-13"><i>{{table.footer_desc}}</i></h5>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="mt-2">
                                            <h5>Interpretasi Data:</h5>
                                            <div data-simplebar="" style="max-height: 419px;"> 
                                                <div class="timeline-alt pb-0">
                                                    
                                                    {% for data_meaning in data_meanings %}
                                                        <div class="timeline-item">
                                                            <span class="bg-info-lighten text-info timeline-icon">{{forloop.counter}}</span>

                                                            <div class="timeline-item-info">
                                                                <a href="#" class="text-info fw-bold mb-1 d-block">Tahun {{data_meaning.year}}</a>
            
                                                                <ul style="padding-left:20px">
                                                                    {% for dt in data_meaning.items %}
                                                                        <li>
                                                                            <small>{{dt.item_period}}</small>
                                                                            <p class="mb-0 pb-2">
                                                                                <small class="text-muted">{{dt.context}}</small>
                                                                            </p>
                                                                        </li>
                                                                    {% endfor %}
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    {% endfor %}

                                                </div>
                                                <!-- end timeline -->
                                            </div> <!-- end slimscroll -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="row" id="graphLine">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="dropdown float-end">
                                            <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="mdi mdi-dots-vertical"></i>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-end px-0 font-13">
                                                <a href="javascript:void(0);" class="dropdown-item" id="export-line-chart"><i class="mdi mdi-download"></i> Export Grafik</a>
                                            </div>
                                        </div>
                                        <h4 class="header-title mb-4">Line Chart</h4>

                                        <div dir="ltr">
                                            <div class="mt-3 chartjs-chart" >
                                                <canvas id="task-line-chart" data-bgcolor="#727cf5" data-bordercolor="#727cf5"></canvas>
                                            </div>
                                            <br>
                                            <span>{{table.footer_desc}} (diolah)</span>
                                        </div>

                                    </div> <!-- end card body-->
                                </div> <!-- end card -->
                            </div>
                        </div>
                        
                                                
                        <div class="row" id="graphBar">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="dropdown float-end">
                                            <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="mdi mdi-dots-vertical"></i>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-end px-0 font-13">
                                                <a href="javascript:void(0);" class="dropdown-item" id="export-bar-chart"><i class="mdi mdi-download"></i> Export Grafik</a>
                                            </div>
                                        </div>
                                        <h4 class="header-title mb-4">Bar Chart</h4>

                                        <div dir="ltr">
                                            <div class="mt-3 chartjs-chart">
                                                <canvas id="task-bart-chart" data-bgcolor="#727cf5" data-bordercolor="#727cf5"></canvas>
                                            </div>
                                            <br>
                                            <span>{{table.footer_desc}} (diolah)</span>
                                        </div>

                                    </div> <!-- end card body-->
                                </div> <!-- end card -->
                            </div><!-- end col-->
                        </div>
                        <!-- end row-->

                        <div class="row" id="graphPie">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="dropdown float-end">
                                            <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="mdi mdi-dots-vertical"></i>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-end px-0 font-13">
                                                <a href="javascript:void(0);" class="dropdown-item" id="export-pie-chart"><i class="mdi mdi-download"></i> Export Grafik</a>
                                            </div>
                                        </div>
                                        <h4 class="header-title mb-4">Pie Chart</h4>

                                        <div dir="ltr">
                                            <div class="mt-3 chartjs-chart" >
                                                <canvas id="pie-chart" data-bgcolor="#727cf5" data-bordercolor="#727cf5"></canvas>
                                            </div>
                                            <br>
                                            <span>{{table.footer_desc}} (diolah)</span>
                                        </div>

                                        

                                    </div> <!-- end card body-->
                                </div> <!-- end card -->
                            </div>
                        </div>
                        
                    </div>
                    <div class="tab-pane" id="data_comparisons">
                        {% if data_comparisons_title %}
                        <div class="card pb-3" style="box-shadow:none">
                            <div class="card-body px-3 mt-4 mt-lg-0">
                                <div class="mb-3">
                                    <h4 class="font-weight-bold"><strong>{{data_comparisons_title}}</strong></h4>
                                </div>
                                <div class="mt-1">
                                    <p class="font-weight-light font-13">{% if data_comparisons_title %}Terakhir diperbarui: {{table_last_updated|date:"d F Y" }}{% endif %}
                                    </p>
                                </div>
                                
                                <div class="row my-1">
                                    <div class="col-sm-6">
                                        
                                        <div class="form-check form-switch mb-2">
                                            <input type="checkbox" class="form-check-input" id="customSwitch1" onchange="showData()">
                                            <label class="form-check-label font-14" for="customSwitch1">Tampilkan Data Pembanding</label>
                                        </div>
                                        
                                    </div>
                                    <div class="col-sm-6 d-flex justify-content-end" style="padding-right:18px!important">
                                        <button type="button" class="btn btn-primary" style="margin-right:3px!important" data-bs-toggle="popover" title="Berhasil !" data-bs-content="Tautan berhasil disalin."  id="clipboard-btn"><i class="mdi mdi-clipboard-file"></i> </button>
                                        <button type="button" class="btn btn-success" style="margin-right:3px!important"><i class="mdi mdi mdi-file-excel"></i> </button>
                                        <button type="button" class="btn btn-info" style="margin-right:3px!important"><i class="mdi mdi-file-pdf"></i> </button>
                                    </div>
                                    
                                </div>
                                <div class="view">
                                    <div class="wrapper">
                                        
                                        <table class="table table-sm table-striped table-centered nowrap w-100 mb-1 font-14" id="content-table">
                                            <thead style="background-color:#2262AB;color:white">
                                                <tr>
                                                    <th rowspan="3" class="text-center sticky-col header-col first-col">No</th>
                                                    <th rowspan="3" class="sticky-col header-col second-col">{{table.row_group_id.name}}</th>
                                                </tr>
                                                    
                                                {% for item_years in data_comparisons.0.items %}
                                               
                                                <tr>
                                                {% for item_periods in item_years.items %}
                                                    <th colspan="{{item_periods.items|length}}" class="text-center {% if forloop.counter > 1 %}compare-item d-none{% endif %}">{{ item_periods.item_period }} {% if forloop.counter > 1 %}{{item_years.year}}{% endif %}</th>
                                                {% endfor %}
                                                </tr>

                                                <tr>
                                                {% for item_periods in item_years.items %}
                                                    {% with idx=forloop.counter %}
                                                        {% for item_cols in item_periods.items %}
                                                            <th class="text-center {% if idx > 1 %}compare-item d-none{% endif %}">{{ item_cols.item_char }}</th>
                                                        {% endfor %}
                                                    {% endwith %}
                                                {% endfor %}
                                                </tr>
                                                {% endfor %} 
                                            </thead>

                                            <tbody>
                                                {% for item_rows in data_comparisons %}
                                                    <tr>
                                                        <td class="text-center sticky-col first-col">{{forloop.counter}}</td>
                                                        <td class="sticky-col second-col">{{item_rows.row_name}}</td>
                                                        {% for item_years in item_rows.items %}
                                                            {% for item_periods in item_years.items %}
                                                                {% with idx_col=forloop.counter0 %}
                                                                    {% for item_cols in item_periods.items %}
                                                                        {% if idx_col == 0 %}
                                                                        <td class="text-center {{ item_cols.class_ }} comparison-col {% if forloop.last %} border-between {% endif %}" data-bs-toggle="popover" data-bs-trigger="hover" data-bs-content="{{item_cols.content}}" title="{{item_cols.title}}">
                                                                            {{ item_cols.value|safe }}
                                                                        </td>
                                                                        {% else %}
                                                                        <td class="text-center {% if forloop.last %} border-between {% endif %} compare-item d-none">{{ item_cols.value }}</td>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                {% endwith %}
                                                            {% endfor %}
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <h5 class="font-weight-light font-13"><i>{{table.footer_desc}}</i></h5>
                                
                            </div>
                        </div>
                        {% else %}
                        <div class="row my-1">
                            <div class="alert alert-primary">
                                <strong><i class="mdi mdi-information-outline"></i></strong> Silahkan pilih periode data terlebih dahulu!
                            </div>
                        </div>
                        {% endif %}


                        {% if data_comparisons_title %}

                        <div class="row" id="chartComparison">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="dropdown float-end">
                                            <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="mdi mdi-dots-vertical"></i>
                                            </a>
                                            
                                            <div class="dropdown-menu dropdown-menu-end">
                                                <a href="javascript:void(0);" class="dropdown-item" id="export-compare-chart"><i class="mdi mdi-download"></i> Export Grafik</a>
                                            </div>
                                        </div>
                                        <h4 class="header-title mb-4">Grafik Perbandingan</h4>

                                        <div dir="ltr">
                                            <div class="mt-3 chartjs-chart" style="height: 450px;">
                                                <canvas id="task-bart-chart-2" data-bgcolor="#727cf5" data-bordercolor="#727cf5"></canvas>
                                            </div>
                                            {{table.footer_desc}} (diolah)
                                        </div>

                                    </div> <!-- end card body-->
                                </div> <!-- end card -->
                            </div><!-- end col-->
                        </div>
                        <!-- end row-->
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock main-content %}


{% block js-extender %}

<script src="{% static 'app-design/assets/js/vendor/jstree.min.js' %}"></script>
<script src="{% static 'app-design/assets/js/pages/demo.jstree.js' %}"></script>

<script src="{% static 'app-design/assets/js/vendor/Chart.bundle.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script src="{% static 'app-design/assets/js/pages/demo.dashboard-projects.js' %}"></script>

<script>
    
    var filter_period = "{{ request.GET|get_query_periods:'data'|safe }}"
    var compare_qry = '{{ request.GET.compare_by }}'

    function showChart(target){
        if ($(target).hasClass("d-none")){
            $(target).removeClass('d-none')
        }else{
            $(target).addClass('d-none')
        }
    }

    $( window).resize(function(){
        if($(this).width() <= 768){
            $("#search-content").addClass('d-none')
            $(".hero-section").removeAttr('style')
            $("#main-content").css('margin-top', '-200px')
            $("#expandButton").addClass('d-none')
            $("#top-search-mitra").css('width', '200px')
        }else{
            $("#search-content").removeClass('d-none')
            $(".hero-section").css('height', '630px')    
            $("#main-content").css('margin-top', '-50px')
            $("#expandButton").removeClass('d-none')
            $("#top-search-mitra").css('width', '400px')
        }
    });

    $("#expandButton").on('click', function (event){
        if ($('#main-content').css('margin-top') == '-50px'){
            $("#search-content").addClass('d-none')
            $(".hero-section").removeAttr('style')
            $("#main-content").css('margin-top', '-200px')
            $(this).parent().css({'bottom': '-98px'})
        }else{
            $(this).parent().css('bottom', '-253px')
            $(".hero-section").css('height', '630px')    
            $("#search-content").removeClass('d-none')
            $("#main-content").css('margin-top', '-50px')
        }
    })

    $('.filterPeriod, .filterPeriodLabel, .filterPeriodStart, .filterPeriodLabelStart, .filterPeriodEnd, .filterPeriodLabelEnd').on('click', function (e){
        e.stopPropagation();
    })

    $('.filterPeriodStart').on('change', function (e){
        $(".filterPeriodStart").prop('checked', false);
        $(this).prop('checked', true);
    })

    $('.filterPeriodEnd').on('change', function (e){
        $(".filterPeriodEnd").prop('checked', false);
        $(this).prop('checked', true);
    })


    $('.filterData').on('click', function (e){
        var pageURL = '{{ request.path }}?indicator={{table.id}}';
        $('.filterPeriod:checkbox:checked').each(function () {
            pageURL += '&data='+ $(this).val()
        });
        
        if (compare_qry.length > 0) {
            pageURL += '&compare_by=' + compare_qry
        }
        
        return $(location).attr('href', pageURL);
    })

    $('#fullscreen_table').on('change', function (e){

        if ($('#sidebar-table-content').hasClass("d-none")){
            $('#sidebar-table-content').removeClass().addClass('col-lg-3')
            $('#main-table-content').removeClass().addClass('col-lg-9')
        } else{
            $('#sidebar-table-content').removeClass().addClass('d-none')
            $('#main-table-content').removeClass().addClass('col-lg-12')
        }

    })


    $(".yearPeriod, .yearPeriodStart").on("click", function (e) {
        e.stopPropagation();
        var list_item = $(this).find('ul')
        if (!list_item.hasClass("show")){
            $(this).find('ul').not(list_item).removeClass('show').addClass('d-none');
            list_item.removeClass("d-none")
            list_item.addClass("show")
        } else{
            list_item.removeClass("show")
            list_item.addClass("d-none")
        }
    })

    $(".compareData").on('click', function (e){
        var pageURL = '{{ request.path }}?indicator={{table.id}}';
        var data_start = $('.filterPeriodStart:checkbox:checked').val()
        var data_end = $('.filterPeriodEnd:checkbox:checked').val()

        if (data_start && data_end){
            
            if (data_start == data_end){
                return push_notif("Terjadi Kesalahan!", "Periode awal tidak boleh melebihi/sama dengan periode akhir.", "error") 
            }

            compare_qry = '&compare_by=' + data_start + '-' + data_end

            if (filter_period.length > 0) {
                pageURL += filter_period
            }

            pageURL += compare_qry
            return $(location).attr('href', pageURL);
        } else {
            return false
        }

    })

    $('#clipboard-btn').on('click', function(e){
        e.preventDefault()
        setTimeout(function () {
            $('#clipboard-btn').popover('hide');
        }, 1500);
    })
    
</script>

<script>

    const randomColor = (i) => {
        const colors = ['#A3E4D7','#76D7C4', '#48C9B0','#1ABC9C', '#17A589', '#148F77','#117864'];
        return colors[i % colors.length];
      }

    function showData(){
        if ($('.compare-item').hasClass('d-none')){
            $('.compare-item').removeClass('d-none')
        }else{
            $('.compare-item').addClass('d-none')
        }
    }

    function show_comparison_panel(state){
        if (state == 'comp'){
            $("#comparison-card").removeClass('d-none')
            $("#dataset-card").addClass('d-none')
        }else{
            $("#dataset-card").removeClass('d-none')
            $("#comparison-card").addClass('d-none')
        }
    }

    function exportChart(chart, title){
        var a = document.createElement('a');
        a.href = chart.toBase64Image();
        a.download = title;
        // Trigger the download
        a.click();
    }

    let draw = Chart.controllers.line.prototype.draw;
    Chart.controllers.line = Chart.controllers.line.extend({
        draw: function() {
            let ctx = this.chart.chart.ctx;
            ctx.save();
            ctx.shadowColor = '#1CB395';
            ctx.shadowBlur = 12;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 5;
            ctx.stroke();
            draw.apply(this, arguments);
            ctx.restore();
        }
    });

    var pie_chart = new Chart('pie-chart', {
        type: 'doughnut',
        data: {
        datasets: [
        /* Outer doughnut data starts*/
        {% for dt in chart_data.data_pie %}
        {
            data: {{dt|safe}},
            backgroundColor: ['#A3E4D7','#76D7C4', '#48C9B0','#1ABC9C', '#17A589', '#148F77','#117864'],
        },
        {% endfor %}
       
        /* Inner doughnut data ends*/
        ],
        labels: {{chart_data.label_pie_chart|safe}}
        },
        options: {
            plugins: {
                datalabels: {
                formatter: (value) => {
                    return value + '%';
                },
                },
            },
            title: {
                position: 'right',
                display: true,
                text: {{chart_data.label_pie_layer|safe}},
                fontSize:11,
                fontStyle:'normal',
                fontFamily: ['Nunito', 'sans-serif']
            },
            legend: {
            position: 'right',
            labels: {
                usePointStyle: true
            },
            },
        }
    })

    var line_chart = new Chart('task-line-chart', {
        type: 'line',
        
        data: {
            labels: {{chart_data.labels|safe}},    
            datasets: [
                {% for dt in chart_data.data %}
                    {
                        label: '{{dt.label|safe}}',
                        data: {{dt.data|safe}},
                        fill: false,
                        borderColor: randomColor({{forloop.counter}}),
                        backgroundColor:randomColor({{forloop.counter}}),
                        borderWidth: 1.2,
                    },
                {% endfor %}
            ]
        },
        options: {
            legend: {
            position: 'bottom',
            labels: {
                usePointStyle: true
            }
            },
            scales: {
                yAxes: [{
                    scaleLabel: {
                    display: true,
                    labelString: '{{chart_data.agg|safe}}'
                    }
                }],
                xAxes: [{
                    gridLines: {
                        drawOnChartArea: false,
                        
                    }
                    },
                ]
            },
            
        },
        showDatapoints: true,

    })

    var bar_chart = new Chart('task-bart-chart', {
        type: 'bar',
        data: {
            labels: {{chart_data.labels|safe}},
            datasets: [

                {% for dt in chart_data.data %}
                    {
                        label: '{{dt.label|safe}}',
                        data: {{dt.data|safe}},
                        borderColor: randomColor({{forloop.counter}}),
                        backgroundColor:randomColor({{forloop.counter}}),
                        borderWidth: 1.2,
                    },
                {% endfor %}
            ]
        },
        options: {
            legend: {
            position: 'bottom',
            labels: {
                usePointStyle: true
            }
            },
            scales: {
            yAxes: [{
                scaleLabel: {
                display: true,
                labelString: '{{chart_data.agg|safe}}'
                }
            }],
            xAxes: [{
                gridLines: {
                    drawOnChartArea: false
                }
                },
            ]
            }
        }
    });

    {% if data_comparisons_title %}
    var compare_chart = new Chart('task-bart-chart-2', {
        type: 'bar',
        data: {
            labels: {{chart_data_compare.labels|safe}},
            datasets: [

                {% for dt in chart_data_compare.data %}
                    {
                        label: '{{dt.label|safe}}',
                        data: {{dt.data|safe}},
                        borderColor: randomColor({{forloop.counter}}),
                        backgroundColor:randomColor({{forloop.counter}}),
                        borderWidth: 1.2,
                    },
                {% endfor %}
            ]
        },
        options: {
            legend: {
            position: 'bottom',
            labels: {
                usePointStyle: true
            }
            },
            scales: {
            yAxes: [{
                scaleLabel: {
                display: true,
                labelString: '{{chart_data_compare.agg|safe}}'
                }
            }],
            xAxes: [{
                gridLines: {
                    drawOnChartArea: false
                }
                },
            ]
            }
        }
    });
    {% endif %}

</script>

<script>

    $('#export-line-chart').on('click', function(e){
        exportChart(line_chart, 'Line chart - {{table.name}}.png')
    })

    $('#export-bar-chart').on('click', function(e){
        exportChart(bar_chart, 'Bar chart - {{table.name}}.png')
    })

    $('#export-pie-chart').on('click', function(e){
        exportChart(pie_chart, 'Pie chart - {{table.name}}.png')
    })

    $('#export-compare-chart').on('click', function(e){
        exportChart(compare_chart, 'Grafik Komparasi - {{data_comparisons_title}}.png')
    })
</script>

{% endblock js-extender %}
