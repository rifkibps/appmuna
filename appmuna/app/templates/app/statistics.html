{% extends 'horizontal/home_app.html' %}

{% load static %}

{% block css-extender %}
<style>

    .bottom-wrapper {
        margin-top: 1.5em;
        font-size:13px;
    }

    #expandButton:focus {     
        box-shadow:none;    
    }

    .app-stat-active, #table-statistic-app:hover {
        box-shadow: 0 0 20px #5561F2;
        height:185px!important;
        width:205px!important
      }
    
      .app-dev-active, #table-dev-app:hover{
        box-shadow: 0 0 20px #F73D62;
        height:185px!important;
        width:205px!important
      }

          
      .app-str-active, #table-str-app:hover{
        box-shadow: 0 0 20px #07BD8A;
        height:185px!important;
        width:205px!important
      }
      
      .app-bigdata-active,#table-bigdata-app:hover{
        box-shadow: 0 0 20px #0BAAD7;
        height:185px!important;
        width:205px!important
      }
</style>
{% endblock css-extender %}

{% block main-content %}
<!-- START HERO -->


<section class="hero-section" style="height:630px">
    <div class="container">
        <div class="row align-items-center" id="search-content">
            <div class="col-md-6 mt-4">
                <div class="">
                    <div>
                        <span class="badge bg-danger rounded-pill">Baru</span> 
                        <span class="text-white-50 ms-1">Selamat datang di portal Satu Data Muna</span>
                    </div>
                    <h3 class="text-white fw-normal my-3 hero-title">
                        Telusuri Data Statistik Kabupaten Muna
                    </h3>
                    <p class="pr-2 mb-3 font-15 text-white-50"><span class="text-white fw-normal">SDM</span> merupakan wujud sinergi dan kolaborasi bersama antara BPS Kab. Muna selaku penyedia layanan data.</p>

                    <div class="row align-items-start">
                        <div class="col-lg-12 d-flex justify-content-start">
                            <div class="app-search dropdown">
                                <form> 
                                    <div class="row gy-2 gx-2">
                                        <div class="col-12">
                                            <div class="input-group">
                                                <form action="{% url 'app:search-app' %}" method="get">
                                                    <input type="text" class="form-control" placeholder="Telusuri data statistik ..." id="top-search-mitra" autocomplete="off" style="width:400px;height:50px;background-color:#ffffff;border-radius:5px">
                                                    <span class="mdi mdi-magnify search-icon" style="margin-top:5px"></span>
                                                    <button class="btn btn-danger rounded" style="height:48px;margin-left:8px" id="button-top-search">Telusuri Data</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 offset-md-2">
                <div class="text-md-end mt-1">
                    <img src="{% static 'app-design/assets/images/startup.svg' %}" alt="" class="img-fluid">
                </div>
            </div>
        </div>

    </div>
</section>

<!-- END HERO -->
<section class="py-4 bg-white" id="main-content" style="margin-top:-50px;">
    <div class="container" >
        <div class="row justify-content-end">
            <button class="btn bg-white"  style="width:100px; height:40px; font-size:12px; border-radius:20px; margin-top:-45px; padding: 8px 0px 8px 5px; z-index:10; margin-right:10px!important;" id="expandButton">Expand <i class="mdi mdi-arrow-up-down"></i></button>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="page-title-box">
                    <div class="page-title-left">
                        <ol class="breadcrumb m-0">
                            <li class="breadcrumb-item"><a href="javascript: void(0);" style="color:#003C80">Beranda</a></li>
                            <li class="breadcrumb-item active text-truncate"><a href="javascript: void(0);" style="color:#003C80">Tabel Statistik</a></li>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <div class="row py-2">
            <div class="col-12">
                <div class="mb-2">
                    <h3 class="font-weight-bold" style="color:#003C80"><strong>Tabel Statistik</strong></h3>
                    <br>
                    <p>
                        Revolusi Mental merupakan Gerakan untuk mengubah cara pandang, cara piker, sikap, perilaku, dan cara kerja bangsa Indonesia, yang mengacu pada nilai-nilai integritas, etos kerja, gotong royong, berlandaskan Pancasila sehingga bangsa Indonesia menjadi negara yang maju, modern, makmur, sejahtera, dan bermartabat. Revolusi Mental memiliki tiga tujuan. Pertama, untuk membangkitkan kesadaran dan membangun sikap optimistik dalam menatap masa depan Indonesia sebagai negara dengan kekuatan besar untuk berprestasi tinggi dan produktif sehingga menjadi bangsa yang maju dan modern. Kedua, untuk mengubah cara pandang, cara pikir, sikap, perilaku, dan cara kerja yang berorientasi pada kemajuan dan kemodernan sehingga Indonesia menjadi bangsa yang besar dan berdaya saing sehingga mampu berkompetisi dengan bangsa-bangsa lain. Ketiga, untuk mewujudkan Indonesia yang berdaulat dalam politik, berdikari dalam ekonomi, dan berkepribadian dalam kebudayaan melalui pembentukan manusia Indonesia baru yang unggul.
                    </p>
                </div>
            </div>
        </div>
        
    </div>
</section>


<section class="pt-2 pb-4" >
    <div class="container " >
        <div class="row p-2">
            <div class="col-lg-3">
                <h4 class="p-2" ><i class="mdi mdi-arch"></i> Subjek Statistik</h4>

                <div class="card mb-2">
                    <div class="card-body">
                        <div class="card-widgets">
                            <a data-bs-toggle="collapse" href="#cardCollpase" role="button" aria-expanded="false" aria-controls="cardCollpase"><i class="mdi mdi-chevron-double-right"></i></a>
                        </div>

                        <div class="d-flex align-items-start">
                            <img class="me-3 rounded-circle" src="{% static 'customs/images/social.png' %}" width="40" alt="Generic placeholder image">
                            <h5 class="card-title mb-0" style="color:#003C80">{{subjects.0.groups}}</h5>
                        </div>
                                        
                        <div id="cardCollpase" class="collapse pt-3 show">
                            <ul style="padding-left:0px!important;font-size:15px">

                                {% for item in subjects.0.items %}
                                    <li style="list-style:none;"><p><a href="javascript:void(0)" class="text-secondary subject-filter" data-subj="{{item.id}}"> {{item.name}} <span class="badge badge-primary-lighten float-end ms-2">{{item.count}}</span></a></p></li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div> <!-- end card-->

                <div class="card mb-2">
                    <div class="card-body">
                        <div class="card-widgets">
                            <a data-bs-toggle="collapse" href="#cardCollpase2" role="button" aria-expanded="false" aria-controls="cardCollpase2"><i class="mdi mdi-chevron-double-right"></i></a>
                        </div>

                        <div class="d-flex align-items-start">
                            <img class="me-3 rounded-circle" src="{% static 'customs/images/economics.png' %}" width="40" alt="Generic placeholder image">
                            <h5 class="card-title mb-0" style="color:#003C80">{{subjects.1.groups}}</h5>
                        </div>
                                        
                        <div id="cardCollpase2" class="collapse pt-3">
                            <ul style="padding-left:10px!important">
                                {% for item in subjects.1.items %}
                                    <li style="list-style:none;"><p><a href="javascript:void(0)" class="text-secondary"> {{item.name}} <span class="badge badge-primary-lighten float-end ms-2">{{item.count}}</span></a></p></li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div> <!-- end card-->
          
                <div class="card mb-2">
                    <div class="card-body">
                        <div class="card-widgets">
                            <a data-bs-toggle="collapse" href="#cardCollpase3" role="button" aria-expanded="false" aria-controls="cardCollpase3"><i class="mdi mdi-chevron-double-right"></i></a>
                        </div>

                        <div class="d-flex align-items-start">
                            <img class="me-3 rounded-circle" src="{% static 'customs/images/farm.png' %}" width="40" alt="Generic placeholder image">
                            <h5 class="card-title mb-0" style="color:#003C80">{{subjects.2.groups}}</h5>
                        </div>
                        
                                        
                        <div id="cardCollpase3" class="collapse pt-3">
                            <ul style="padding-left:10px!important">

                                {% for item in subjects.2.items %}
                                    <li style="list-style:none;"><p><a href="javascript:void(0)" class="text-secondary"> {{item.name}} <span class="badge badge-primary-lighten float-end ms-2">{{item.count}}</span></a></p></li>
                                {% endfor %}
 
                            </ul>
                        </div>
                    </div>
                </div> 
            </div>
    
            <div class="col-lg-9 px-4 mt-5">
                <div class="card pb-3">
                    <div class="card-body px-3 pt-2 pb-0">
                        <div class="mb-3">
                            <h4 class="font-weight-bold"><strong>Indikator Statistik</strong></h4>
                        </div>
                        <div class="row mb-1">
                            <div class="col-6">
                                <button type="button" class="btn btn-primary" style="margin-right:3px!important" id="refresh"><i class="mdi mdi-filter-off"></i> </button>
                                <button type="button" class="btn btn-success" style="margin-right:3px!important"><i class="mdi mdi mdi-file-excel"></i> </button>
                                <button type="button" class="btn btn-info" style="margin-right:3px!important"><i class="mdi mdi-file-pdf"></i> </button>
                            </div>
                            <div class="col-6 d-flex justify-content-end">
                                <input type="text" class="form-control form-control-sm" id="search-box" placeholder="Cari data ..." style="width:250px">
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-centered nowrap w-100 font-14" id="statistics-table">
                                <thead >
                                    <tr>
                                        <th class="text-center">No</th>
                                        <th>Data Statistik</th>
                                        <th class="text-center">Periode Data</th>
                                        <th class="text-center">Update Terakhir</th>
                                        <th class="text-center"></th>
                                    </tr>
                                 
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</section>
{% endblock main-content %}


{% block js-extender %}

<script>

    $( window).resize(function(){
        if($(this).width() <= 768){
            $("#search-content").addClass('d-none')
            $(".hero-section").removeAttr('style')
            $("#main-content").css('margin-top', '-200px')
            $("#expandButton").addClass('d-none')
            $("#top-search-mitra").css('width', '200px')
        }else{
            $("#search-content").removeClass('d-none')
            $(".hero-section").css('height', '630px')    
            $("#main-content").css('margin-top', '-50px')
            $("#expandButton").removeClass('d-none')
            $("#top-search-mitra").css('width', '400px')
        }
    });


    $("#expandButton").on('click', function (event){
        if ($('#main-content').css('margin-top') == '-50px'){
            $("#search-content").addClass('d-none')
            $(".hero-section").removeAttr('style')
            $("#main-content").css('margin-top', '-200px')
            $(this).parent().css({'bottom': '-98px'})
        }else{
            $(this).parent().css('bottom', '-253px')
            $(".hero-section").css('height', '630px')    
            $("#search-content").removeClass('d-none')
            $("#main-content").css('margin-top', '-50px')
        }
    })

</script>

<script>
    var subj_filter 
    var table = $("#statistics-table").DataTable({
        info:false,
        searching: false,
        lengthChange: false,
        processing: true,
        serverSide: true,
        fixedColumns: true,
        pageLength: 7,
        ajax: {
            "url": "{% url 'app:statistics-app-data' %}",
            "headers": {
                "X-Requested-With": "XMLHttpRequest",
                "X-CSRFToken": '{{csrf_token}}',
            },
            "type": "POST",
            "data": function (d){
                return $.extend({}, d, {
                    "search-box": $('#search-box').val(),
                    "subject":subj_filter,
                })
            },
        },
        columns :[
            {"data": 'no'},
            {"data": 'indicator_id__name'},
            {"data" : 'indicator_id__time_period_id__name'},
            {"data" : 'indicator_id__updated_at'},
            {"data" : 'actions'},
        ],
        order: [[1, 'asc']],
        columnDefs: [
         {
            'targets': [4], /* column index */
            'orderable': !1, /* true or false */             
        },
        { targets: [0,2,3,4], className: 'text-center' }
        ],
        
        dom: 'lfrti<"bottom-wrapper"p>',
        language: {
            paginate: {
            previous: "<i class='mdi mdi-chevron-left'>",
            next: "<i class='mdi mdi-chevron-right'>",
            },
        },
        drawCallback: function () {
            $(".dataTables_paginate > .pagination").addClass("pagination-rounded");
          },
    });

    $("#refresh").on("click", function (){
        subj_filter = null
        $('#search-box').val('')
        removeBadgeStyle()
        table.draw()
    })

    $('#search-box').on("input", function (){
        table.draw()
    })

    $( window).resize(function(){
        if($(this).width() <= 768){
            $("#search-content").addClass('d-none')
            $(".hero-section").removeAttr('style')
            $("#main-content").css('margin-top', '-200px')
            $("#expandButton").addClass('d-none')
            $("#top-search-mitra").css('width', '200px')
        }else{
            $("#search-content").removeClass('d-none')
            $(".hero-section").css('height', '630px')    
            $("#main-content").css('margin-top', '-50px')
            $("#expandButton").removeClass('d-none')
            $("#top-search-mitra").css('width', '400px')
        }
    });

    $("#expandButton").on('click', function (event){
        if ($('#main-content').css('margin-top') == '-50px'){
            $("#search-content").addClass('d-none')
            $(".hero-section").removeAttr('style')
            $("#main-content").css('margin-top', '-200px')
            $(this).parent().css({'bottom': '-98px'})
        }else{
            $(this).parent().css('bottom', '-253px')
            $(".hero-section").css('height', '630px')    
            $("#search-content").removeClass('d-none')
            $("#main-content").css('margin-top', '-50px')
        }
    })

</script>

<script>

    function removeBadgeStyle(){
        $('.subject-filter').attr('class', 'text-secondary subject-filter')
        $('.subject-filter').parent().parent().removeAttr('class', 'rounded bg-primary px-2 pt-1 mb-1 ')
        $('.subject-filter').parent().parent().css('line-height','')
        $('.subject-filter').children().removeClass('bg-white text-primary')
        $('.subject-filter').children().addClass('badge-primary-lighten')
    }

    $('.subject-filter').on('click', function (event){
        subj_filter = $(this).attr('data-subj')
        removeBadgeStyle()

        $(this).attr('class', 'text-white fw-bold subject-filter')
        $(this).parent().parent().attr('class', 'rounded bg-primary px-2 pt-1 mb-1 ')
        $(this).parent().parent().css('line-height','45px')
        $(this).children().removeClass('badge-primary-lighten')
        $(this).children().addClass('bg-white text-primary')
        
        table.draw()
    })
</script>
{% endblock js-extender %}
